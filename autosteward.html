<head>
  <title>AutoSteward</title>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400,300,600,700' rel='stylesheet' type='text/css'>
</head>

<body>
  <div class="container">
    <div class="row vertical-align">
      <div class="col-md-1 pager">
        &#x25C0;
      </div>
      <div class="col-md-10">
        {{#with week}}
          <h1>Week of <span>{{formatDate this "MMMM D"}}</span></h1>
          <div class="panel panel-default">
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th></th>
                  <th>Waiter 1</th>
                  <th>Waiter 2</th>
                  <th>Waiter 3</th>
                </tr>
              </thead>
              <tbody>
                {{#each datesOfCurrentWeek}}
                  <tr>
                    <td>{{formatDate this "dddd"}}</td>
                    {{> cell date=this waiter_number=1}}
                    {{> cell date=this waiter_number=2}}
                    {{> cell date=this waiter_number=3}}
                  </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        {{/with}}
      </div>
      <div class="col-md-1 pager">
          &#x25B6;
      </div>
    </div>
  </div>

  <h1>Roster</h1>
  <div class="container">
    <div class="row vertical-align">
      <table class="table table-bordered table-striped">
      <tbody>
        {{#each brothers}}
          <tr>
            <td>{{> brotherName }}</td>
            <td>
              {{> slab }}
            </td>
            {{> phone }}
          </tr>
        {{/each}}
      </tbody>
      </table>
    </div>
  </div>

  <div class="footer">
    <span>&copy; 2015 AEPi Alpha Kappa</span>
  </div>

</body>

<template name="brotherName">
  {{first_name}} {{last_name}} ({{duty_count}})
</template>

<template name="cell">
  <td>
    <div class="dropdown">
      {{#with shift date waiter_number}}
        {{#if anyAvailableWaiters}}
          <button id="dLabel" type="button" class="btn btn-default" data-toggle="dropdown">
            {{#with waiter}}
              {{> brotherName }}
            {{else}}
              <em>Nobody</em>
            {{/with}}
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
            {{#with waiter}}
              <li>
                <a href="#" class="unassign-waiter">
                  <em>Remove {{brother.first_name}}</em>
                </a>
              </li>
            {{/with}}
            {{#each availableWaiters}}
              {{#unless brotherIsWaiter this}}
                <li>
                  <a href="#" class="assign-waiter">{{> brotherName }}</a>
                </li>
              {{/unless}}
            {{/each}}
          </ul>
        {{else}}
          <em>no brothers available</em>
        {{/if}}
      {{/with}}
    </div>
  </td>
</template>

<template name="slab">
  {{#each shifts}}
    {{#if currentBrotherHasShift}}
      <button class="remove btn btn-small btn-success">{{day_name}} #{{waiter_number}}</button>
    {{else}}
      <button class="add btn btn-small btn-danger">{{day_name}} #{{waiter_number}}</button>
    {{/if}}
  {{/each}}
</template>

<template name="phone">
  {{#if phone_number}}
    <td class="phone-cell">
      <a href="tel://{{phone_number}}">
        <span class="glyphicon glyphicon-phone" data-toggle="tooltip" data-placement="top" title="{{phone_number}}"></span>
      </a>
    </td>
  {{else}}
    <td class="phone-cell phone-cell-problem">
      <a class="add-phone" href="#">
        <span class="glyphicon glyphicon-phone" data-toggle="tooltip" data-placement="top" title="No phone number"></span>
      </a>
    </td>
  {{/if}}
</template>